{% extends "master.html" %}
{% block content %}
<div class="items-center mb-5">
<<<<<<< HEAD
<<<<<<< HEAD
    <h1 class="text-2xl font-bold mb-5">Flights Table</h1>
    <a href="{% url 'add_flight' %}" 
       class="bg-green-800 hover:bg-green-900 text-white py-2 px-4 rounded inline-flex items-center">
        <i class="fas fa-plus mr-2"></i>
=======
    <h1 class="unbounded">Flights Table</h1>
    <!-- Add Flight Button -->
    <button 
        onclick="document.getElementById('addFlightModal').classList.remove('hidden')" 
        class="bg-green-800 hover:bg-green-900 text-white py-2 px-4 rounded inline-flex items-center poppins">
        <i class="ph ph-plus mr-2"></i>
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3
        Add Flight
    </button>

       <!-- Excel Import -->
        <form action="{% url 'import_flights' %}" method="post" enctype="multipart/form-data" class="inline-flex items-center space-x-2 poppins">
            {% csrf_token %}
            <input type="file" name="file" accept=".xlsx" required class="border rounded px-2 py-1 text-sm">
            <button type="submit" class="bg-blue-800 hover:bg-blue-900 text-white py-2 px-4 rounded poppins">
                <i class="ph ph-upload mr-1"></i> Import Excel
            </button>
        </form>
    </div>
</div>

<!-- ✅ Messages Section -->
{% if messages %}
<div class="mt-4">
    {% for message in messages %}
        <div class="px-4 py-2 rounded mb-2 
                    {% if message.tags == 'success' %}
                        bg-green-100 text-green-700 border border-green-400
                    {% elif message.tags == 'error' %}
                        bg-red-100 text-red-700 border border-red-400
                    {% else %}
                        bg-gray-100 text-gray-700 border border-gray-400
                    {% endif %}">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<!-- Flights Table -->
<table class="table-auto border-collapse border border-gray-400 w-full">
    <thead>
        <tr class="bg-gray-200">
=======
    <h1 class="unbounded">Flights Table</h1>
    <!-- Add Flight Button -->
    <button 
        onclick="document.getElementById('addFlightModal').classList.remove('hidden')" 
        class="bg-green-800 hover:bg-green-900 text-white py-2 px-4 rounded inline-flex items-center poppins">
        <i class="ph ph-plus mr-2"></i>
        Add Flight
    </button>

       <!-- Excel Import -->
        <form action="{% url 'import_flights' %}" method="post" enctype="multipart/form-data" class="inline-flex items-center space-x-2 poppins">
            {% csrf_token %}
            <input type="file" name="file" accept=".xlsx" required class="border rounded px-2 py-1 text-sm">
            <button type="submit" class="bg-blue-800 hover:bg-blue-900 text-white py-2 px-4 rounded poppins">
                <i class="ph ph-upload mr-1"></i> Import Excel
            </button>
        </form>
    </div>
</div>

<!-- ✅ Messages Section -->
{% if messages %}
<div class="mt-4">
    {% for message in messages %}
        <div class="px-4 py-2 rounded mb-2 
                    {% if message.tags == 'success' %}
                        bg-green-100 text-green-700 border border-green-400
                    {% elif message.tags == 'error' %}
                        bg-red-100 text-red-700 border border-red-400
                    {% else %}
                        bg-gray-100 text-gray-700 border border-gray-400
                    {% endif %}">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<!-- Flights Table -->
<table class="table-auto border-collapse border border-gray-400 w-full">
    <thead>
        <tr class="bg-gray-200 poppins">
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3
            <th class="border border-gray-400 px-4 py-2">Flight Number</th>
            <th class="border border-gray-400 px-4 py-2">Airline</th>
            <th class="border border-gray-400 px-4 py-2">Aircraft</th>
            <th class="border border-gray-400 px-4 py-2">Route</th>
            <th class="border border-gray-400 px-4 py-2">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for flight in flights %}
<<<<<<< HEAD
        <tr>
=======
        <tr class="poppins-small">
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3
            <td class="border border-gray-400 px-4 py-2">{{ flight.flight_number }}</td>
            <td class="border border-gray-400 px-4 py-2">{{ flight.airline.name }}</td>
            <td class="border border-gray-400 px-4 py-2">{{ flight.aircraft.model }}</td>
            <td class="border border-gray-400 px-4 py-2">{{ flight.route }}</td>
            <td class="border border-gray-400 px-4 py-2 text-center space-x-2">
<<<<<<< HEAD
<<<<<<< HEAD
                <a href="{% url 'update_flight' flight.id %}" 
                   class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm inline-flex items-center">
                    <i class="fas fa-edit mr-1"></i>Edit
                </a>
                <a href="{% url 'delete_flight' flight.id %}" 
                   class="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded text-sm inline-flex items-center"
                   onclick="return confirm('Are you sure you want to delete this flight?')">
                    <i class="fas fa-trash-alt mr-1"></i>Delete
                </a>
=======
                <!-- Edit Button -->
                <button 
                    onclick="document.getElementById('editFlightModal{{ flight.id }}').classList.remove('hidden')" 
                    class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded inline-flex items-center">
                    <i class="ph ph-pen mr-1"></i>Edit
                </button>
                <!-- Delete Button -->
                <button 
                    onclick="document.getElementById('deleteFlightModal{{ flight.id }}').classList.remove('hidden')" 
                    class="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded inline-flex items-center">
                    <i class="ph ph-trash mr-1"></i>Delete
                </button>
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3
            </td>
        </tr>

        <!-- EDIT FLIGHT MODAL -->
        <div id="editFlightModal{{ flight.id }}" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-1/2 p-3">
                <div class="flex justify-between items-center border-b px-4 py-2">
                    <h2 class="unbounded">Edit Flight</h2>
                    <button onclick="document.getElementById('editFlightModal{{ flight.id }}').classList.add('hidden')" 
                            class="text-gray-600 hover:text-gray-800">&times;</button>
                </div>
                <form method="POST" action="{% url 'update_flight' flight.id %}" class="p-4">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="block poppins">Flight Number</label>
                        <input type="text" name="flight_number" value="{{ flight.flight_number }}" class="border rounded w-full px-3 py-2 poppins" required>
                    </div>
                    <div class="mb-3">
                        <label class="block poppins">Airline</label>
                        <select name="airline" id="airline-{{ flight.id }}" class="airline-select border rounded w-full px-3 py-2 poppins" required>
                            <option value="">-- Select Airline --</option>
                            {% for airline in airlines %}
                            <option value="{{ airline.id }}" {% if airline.id == flight.airline.id %}selected{% endif %}>
                                {{ airline.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block poppins">Aircraft</label>
                        <select name="aircraft" id="aircraft-{{ flight.id }}" class="aircraft-select border rounded w-full px-3 py-2 poppins" required>
                            <option value="{{ flight.aircraft.id }}">{{ flight.aircraft.model }}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block poppins">Route</label>
                        <select name="route" class="border rounded w-full px-3 py-2 poppins" required>
                            <option value="">-- Select Route --</option>
                            {% for route in routes %}
                            <option value="{{ route.id }}" {% if route.id == flight.route.id %}selected{% endif %}>
                                {{ route }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2 mt-4">
                        <button type="button" onclick="document.getElementById('editFlightModal{{ flight.id }}').classList.add('hidden')" 
                                class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded poppins">Cancel</button>
                        <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white py-2 px-4 rounded poppins">Update</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- DELETE FLIGHT MODAL -->
        <div id="deleteFlightModal{{ flight.id }}" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-1/3 p-3">
                <div class="flex justify-between items-center border-b px-4 py-2  ">
                    <h2 class="unbounded">Confirm Delete</h2>
                    <button onclick="document.getElementById('deleteFlightModal{{ flight.id }}').classList.add('hidden')" 
                            class="text-white hover:text-gray-200">&times;</button>
                </div>
                <div class="p-4 poppins">
                    Are you sure you want to delete flight <strong>{{ flight.flight_number }}</strong>?
                </div>
                <div class="flex justify-end space-x-2 px-4 py-2 border-t">
                    <button type="button" onclick="document.getElementById('deleteFlightModal{{ flight.id }}').classList.add('hidden')" 
                            class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded poppins">Cancel</button>
                    <form method="POST" action="{% url 'delete_flight' flight.id %}">
                        {% csrf_token %}
                        <button type="submit" class="bg-red-700 hover:bg-red-800 text-white py-2 px-4 rounded poppins">Delete</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </tbody>
</table>
<<<<<<< HEAD
=======
                <!-- Edit Button -->
                <button 
                    onclick="document.getElementById('editFlightModal{{ flight.id }}').classList.remove('hidden')" 
                    class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded inline-flex items-center">
                    <i class="ph ph-pen mr-1"></i>Edit
                </button>
                <!-- Delete Button -->
                <button 
                    onclick="document.getElementById('deleteFlightModal{{ flight.id }}').classList.remove('hidden')" 
                    class="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded inline-flex items-center">
                    <i class="ph ph-trash mr-1"></i>Delete
                </button>
            </td>
        </tr>

        <!-- EDIT FLIGHT MODAL -->
        <div id="editFlightModal{{ flight.id }}" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-1/2 p-3">
                <div class="flex justify-between items-center border-b px-4 py-2">
                    <h2 class="unbounded">Edit Flight</h2>
                    <button onclick="document.getElementById('editFlightModal{{ flight.id }}').classList.add('hidden')" 
                            class="text-gray-600 hover:text-gray-800">&times;</button>
                </div>
                <form method="POST" action="{% url 'update_flight' flight.id %}" class="p-4">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="block poppins">Flight Number</label>
                        <input type="text" name="flight_number" value="{{ flight.flight_number }}" class="border rounded w-full px-3 py-2 poppins" required>
                    </div>
                    <div class="mb-3">
                        <label class="block poppins">Airline</label>
                        <select name="airline" id="airline-{{ flight.id }}" class="airline-select border rounded w-full px-3 py-2 poppins" required>
                            <option value="">-- Select Airline --</option>
                            {% for airline in airlines %}
                            <option value="{{ airline.id }}" {% if airline.id == flight.airline.id %}selected{% endif %}>
                                {{ airline.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block poppins">Aircraft</label>
                        <select name="aircraft" id="aircraft-{{ flight.id }}" class="aircraft-select border rounded w-full px-3 py-2 poppins" required>
                            <option value="{{ flight.aircraft.id }}">{{ flight.aircraft.model }}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block poppins">Route</label>
                        <select name="route" class="border rounded w-full px-3 py-2 poppins" required>
                            <option value="">-- Select Route --</option>
                            {% for route in routes %}
                            <option value="{{ route.id }}" {% if route.id == flight.route.id %}selected{% endif %}>
                                {{ route }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2 mt-4">
                        <button type="button" onclick="document.getElementById('editFlightModal{{ flight.id }}').classList.add('hidden')" 
                                class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded poppins">Cancel</button>
                        <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white py-2 px-4 rounded poppins">Update</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- DELETE FLIGHT MODAL -->
        <div id="deleteFlightModal{{ flight.id }}" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-1/3 p-3">
                <div class="flex justify-between items-center border-b px-4 py-2  ">
                    <h2 class="unbounded">Confirm Delete</h2>
                    <button onclick="document.getElementById('deleteFlightModal{{ flight.id }}').classList.add('hidden')" 
                            class="text-white hover:text-gray-200">&times;</button>
                </div>
                <div class="p-4 poppins">
                    Are you sure you want to delete flight <strong>{{ flight.flight_number }}</strong>?
                </div>
                <div class="flex justify-end space-x-2 px-4 py-2 border-t">
                    <button type="button" onclick="document.getElementById('deleteFlightModal{{ flight.id }}').classList.add('hidden')" 
                            class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded poppins">Cancel</button>
                    <form method="POST" action="{% url 'delete_flight' flight.id %}">
                        {% csrf_token %}
                        <button type="submit" class="bg-red-700 hover:bg-red-800 text-white py-2 px-4 rounded poppins">Delete</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </tbody>
</table>
=======
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3

<!-- ADD FLIGHT MODAL -->
<div id="addFlightModal" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-1/2 p-2">
        <div class="flex justify-between items-center border-b px-4 py-2">
            <h2 class="unbounded">Add Flight</h2>
            <button onclick="document.getElementById('addFlightModal').classList.add('hidden')" 
                    class="text-gray-600 hover:text-gray-800">&times;</button>
        </div>
        <form method="POST" action="{% url 'add_flight' %}" class="p-4">
            {% csrf_token %}
            <div class="mb-3">
                <label class="block poppins ">Flight Number</label>
                <input type="text" name="flight_number" class="border rounded w-full px-3 py-2 poppins" required>
            </div>
            <div class="mb-3">
                <label class="block poppins">Airline</label>
                <select name="airline" id="airline-add" class="airline-select border rounded w-full px-3 py-2 poppins" required>
                    <option value="">-- Select Airline --</option>
                    {% for airline in airlines %}
                    <option value="{{ airline.id }}">{{ airline.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="block poppins">Aircraft</label>
                <select name="aircraft" id="aircraft-add" class="aircraft-select border rounded w-full px-3 py-2 poppins" required>
                    <option value="">-- Select Aircraft --</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="block poppins">Route</label>
                <select name="route" class="border rounded w-full px-3 py-2 poppins" required>
                    <option value="">-- Select Route --</option>
                    {% for route in routes %}
                    <option value="{{ route.id }}">{{ route }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" onclick="document.getElementById('addFlightModal').classList.add('hidden')" 
                        class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded poppins">Cancel</button>
                <button type="submit" class="bg-green-700 hover:bg-green-800 text-white py-2 px-4 rounded poppins">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
// Handle airline → aircraft for both add and edit modals
document.querySelectorAll(".airline-select").forEach(select => {
    select.addEventListener("change", function() {
        let airlineId = this.value;
        let modalId = this.id.split("-")[1]; // "add" or flight.id
        let aircraftSelect = document.getElementById("aircraft-" + modalId);
        aircraftSelect.innerHTML = "<option>Loading...</option>";
        fetch("{% url 'load_aircrafts' %}?airline=" + airlineId)
            .then(response => response.json())
            .then(data => {
                aircraftSelect.innerHTML = '<option value="">-- Select Aircraft --</option>';
                data.forEach(item => {
                    aircraftSelect.innerHTML += `<option value="${item.id}">${item.model}</option>`;
                });
            });
    });
});
</script>
<<<<<<< HEAD
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3
=======
>>>>>>> 89a292197b6c61062b72c9b66de9aafd50baeff3
{% endblock %}
