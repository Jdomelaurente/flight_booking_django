{% extends 'booking/base.html' %}
{% block title %} Select a Flight Schedule
{% endblock %}

{% block content %}
{% load static %}

    <main class=" mx-auto  flex justify-center relative mt-7 space-y-2 flex-col ">
        <!-- edit search  -->
        <div class="flex-1 mx-auto max-w-[1200px] px-8 bg-[#ECEAEA] flex  shadow-md/50 w-5xl py-4 h-[82px]  rounded-full justify-between items-center">

            <!-- from -->
            <div class="flex items-center justify-center flex-1 gap-3  ">
                <div class=" flex-1 flex flex-col justify-center  ">
                    <p class="poppins-bold first-of-type: text-base leading-none">{{ origin.code }}</p>
                    <p class="text-[#828282] text-xs" >{{ origin.location }}</p>
                </div>
                <div class="border-2 h-0 w-10"></div>
                <div class="  flex flex-col justify-center  ">
                    <p class="poppins-bold   text-base leading-none">{{ destination.code }}</p>
                    <p class="text-[#828282] text-xs">{{ destination.location }} </p>
                </div>
            </div>

            <!-- depart -->
            <div class="flex items-center leading-none  justify-center   flex-1">
                <div class="  flex flex-col justify-center ">
                    <p class="poppins-bold text-base leading-none">{{ departure_date }}</p>
                    <p class="text-[#828282] text-xs">Depart</p>
                </div>

            </div>

            {% if return_date %}
            <!-- return -->
            <div class="flex items-center leading-none  justify-center   flex-1">
                <div class="  flex flex-col justify-center ">
                    <p class="poppins-bold text-base leading-none">{{ return_date }}</p>
                    <p class="text-[#828282] text-xs">Return</p>
                </div>
            </div>    
            {% endif %}
               

            <!-- passenger -->
           <div class="flex items-center leading-none  justify-center   flex-1">
                <div class="  flex flex-col justify-center ">
                    <p class="poppins-bold text-base leading-none">{{ pasenger_count }}</p>
                    <p class="text-[#828282] text-xs">Passenger</p>
                </div>
            </div>
            <div class="flex items-center leading-none justify-center flex-1 ">
                <button class="bg-[#2975F7] hover:bg-[#2975F7]/80 text-sm cursor-pointer py-2 px-10 rounded-full text-white">Edit search</button>
            </div>
        </div>


        <!-- stepbystep -->
        <div class="bg-[#F4EB08]  mx-auto h-[100px] w-[1100px] shadow-md/50 rounded-[20px] flex flex-col">
            <!-- arrow  -->
            <div class="flex justify-between items-center flex-1 mx-20">
                <div class="   rounded-full p-1 border border-[#2975F7]">
                    <svg  xmlns="http://www.w3.org/2000/svg" width="22" height="22"  class="bg-[#2975F7] p-1 rounded-full"
                        fill="white" viewBox="0 0 24 24" >
                        <path d="m17.54,3.64l-2.9,2.9-9.88-1.16c-.15-.02-.3.03-.41.14l-.59.59c-.24.24-.17.66.14.8l7.01,3.36-3.25,3.25-3.27-.65c-.16-.03-.33.02-.45.14l-.7.7c-.25.25-.17.67.16.81l4.27,1.83,1.83,4.27c.14.33.56.41.81.16l.7-.7c.12-.12.17-.29.14-.45l-.65-3.27,3.31-3.31,3.31,7.06c.15.31.56.39.81.14l.66-.66c.11-.11.16-.26.14-.41l-1.16-9.88,2.75-2.75c.7-.7.88-1.84.29-2.65-.74-1.03-2.19-1.12-3.05-.26Z"></path>
                    </svg>
                </div>

                <div class="flex-1 border text-white"></div>

                <div class="   rounded-full p-1 border border-[#2975F7]">
                   <svg  xmlns="http://www.w3.org/2000/svg" width="22" height="22"  class="bg-[#2975F7] p-1 rounded-full"
                        fill="white" viewBox="0 0 24 24" >
                        <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                        <path d="m19,2H5c-.55,0-1,.45-1,1v4h-2v2h2v2h-2v2h2v2h-2v2h2v4c0,.55.45,1,1,1h14c1.1,0,2-.9,2-2V4c0-1.1-.9-2-2-2Zm-6.5,5c1.43,0,2.5,1.07,2.5,2.5s-1.07,2.5-2.5,2.5-2.5-1.07-2.5-2.5,1.07-2.5,2.5-2.5Zm4.5,10h-9v-1c0-1.66,1.34-3,3-3h3c1.66,0,3,1.34,3,3v1Z"></path>
                    </svg>
                </div>

                <div class="flex-1 border text-white"></div>

                <div class="   rounded-full p-1 border border-[#2975F7]">
                    <svg  xmlns="http://www.w3.org/2000/svg" width="22" height="22"   class="bg-[#2975F7] p-1 rounded-full"
                        fill="white" viewBox="0 0 24 24" >
                        <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"></path>
                    </svg>
                </div>

                <div class="flex-1 border text-white"></div>

                <div class="   rounded-full p-1 border border-[#2975F7]">
                    <svg  xmlns="http://www.w3.org/2000/svg" width="22" height="22"  class="bg-[#2975F7] p-1 rounded-full"
                        fill="white" viewBox="0 0 24 24" >
                        <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                        <path d="m4,5v4h2v-4h4v-2h-4c-1.1,0-2,.9-2,2Z"></path><path d="m6,15h-2v4c0,1.1.9,2,2,2h4v-2h-4v-4Z"></path><path d="m20,19h-4v2h4c1.1,0,2-.9,2-2v-4h-2v4Z"></path><path d="m16,3v2h4v4h2v-4c0-1.1-.9-2-2-2h-4Z"></path><path d="M8 15H18V17H8z"></path><path d="M18 7 8 7 8 11 3 11 3 13 8 13 18 13 23 13 23 11 18 11 18 7z"></path>
                    </svg>
                </div>

                <div class="flex-1 border text-white"></div>

                <div class="   rounded-full p-1 border border-[#2975F7]">
                    <svg  xmlns="http://www.w3.org/2000/svg" width="22" height="22"  class="bg-[#2975F7] p-1 rounded-full"
                        fill="white" viewBox="0 0 24 24" >
                        <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                        <path d="m21,7h-1v-3c0-.55-.45-1-1-1H5c-1.65,0-3,1.35-3,3v12c0,2.2,1.79,3,3,3h16c.55,0,1-.45,1-1v-12c0-.55-.45-1-1-1Zm-3,9h-2v-4h2v4ZM5,5h13v2H5c-.55,0-1-.45-1-1s.45-1,1-1Z"></path>
                    </svg>
                </div>

                <div class="flex-1 border text-white"></div>

                <div class="   rounded-full p-1 border border-[#2975F7]">
                    <svg  xmlns="http://www.w3.org/2000/svg" width="22" height="22"   class="bg-[#2975F7] p-1 rounded-full"
                        fill="white" viewBox="0 0 24 24" >
                        <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                        <path d="M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2m-1.29 13.71c-.2.2-.45.29-.71.29s-.51-.1-.71-.29l-3-3L7.7 11.3l2.29 2.29 5.29-5.29 1.41 1.41-6 6Z"></path>
                    </svg>
                </div>

            </div>

            <!-- label  -->
             <div></div>

        </div>

        <!-- date -->
 
        <div class="flex w-full-auto gap-0.5 mx-auto max-w-[95vw] sm:max-w-[1363px] scrollbar-hide justify-center  py-3">
            <!-- left arrow -->
            <div class="border flex-none w-[50px] h-[82px] flex items-center justify-center rounded-l-2xl border-[#B2B2B2] shadow-md/30">
                <img src="{% static 'bookingapp/images/Expand_left.svg' %}" alt="">
            </div>

            <!-- date cards -->
            {% for i in dates %}
            <div class="flex-none min-w-[140px] border justify-center flex items-center flex-col space-y-2 py-3 border-[#B2B2B2] shadow-md/30 rounded-sm">
                <p class="font-semibold text-sm">08 May 2025</p>
                <p class="text-[10px]">PHP <strong class="text-[10px]">1,123.00</strong></p>
            </div>
            {% endfor %}

            <!-- right arrow -->
            <div class="border flex-none w-[50px] h-[82px] flex items-center justify-center rounded-r-2xl border-[#B2B2B2] shadow-md/30">
                <img src="{% static 'bookingapp/images/Expand_right.svg' %}" alt="">
            </div>
        </div>


         <div class="flex  w-[1000px] flex-col  mx-auto px-5 gap-0.5 ">
            <p class=" text-[#828282] text-sm poppins-regular">Select departing flight</p>
            <div class="flex justify-between">
                <div class="flex  leading-none items-center gap-5 flex-1 ">
                    <div class="  flex  justify-center poppins-regular text-base ">
                        <p class=" text-lg font-semibold">{{ origin.code }}</p>
                        <p>-</p>
                        <p class="text-lg font-semibold">{{ origin.location }}</p>
                    </div>
                    <div class="border-2 h-0 w-10"></div>
                    <div class="  flex  justify-center poppins-regular text-base">
                        <p class="text-lg font-semibold">{{ destination.code }}</p>
                        <p>-</p>
                        <p class="text-lg font-semibold">{{ destination.location }}</p>
                    </div>
                </div>

                <div>
                    <form action="{% url 'bookingapp:reset_selection' %}" method="post" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="bg-red-500 hover:bg-red-600  cursor-pointer text-[10px] py-1 px-4 rounded-full text-white">
                            Reset Selection
                        </button>
                    </form>
                </div>
            </div>

            <div class="flex justify-between mt-5"> 
                <div class="flex gap-4 text-white items-end">
                    <p class="text-[#828282] text-xs "> filter: </p>
                    <button class="py-2 px-3 rounded-full  bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer text-xs flex items-center shadow-md/40  justify-between">Time of Flight
                        <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                            fill="white" viewBox="0 0 24 24" >
                            <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                            <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                        </svg>
                    </button>
                    <button class="py-2 px-5 rounded-full  bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer items-center text-xs  shadow-md/40 flex justify-between">Stops
                        <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                            fill="white" viewBox="0 0 24 24" >
                            <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                            <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                        </svg>
                    </button>
                    <button class="py-2 px-5 rounded-full  bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer items-center text-xs shadow-md/40  flex justify-between"> Price
                        <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                            fill="white" viewBox="0 0 24 24" >
                            <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                            <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                        </svg>
                    </button>
                </div>

                 <div class="flex gap-4 text-white  items-end">
                    <p class="text-[#828282]">Sort by: </p>
                    <button class="py-2 px-5 rounded-full  bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer  text-xs items-center shadow-md/40 flex justify-between">Lowest Price
                        <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15" 
                            fill="white" viewBox="0 0 24 24" >
                            <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                            <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="flex justify-between mt-5 flex-col ">
                <form action="{% url 'bookingapp:select_schedule' %}" method="post">
                    {% csrf_token %}

                <!-- schedule -->
                {% if schedules %}
                {% for schedule in schedules %}
                <div class="w-full h-[100px] border shadow-md/10 rounded-2xl mb-3  px-7 flex justify-between items-center gap-15 text-sm ">
                    <div class="  flex flex-1  justify-between items-center  poppins-regular text-base ">
                        <div class="flex flex-col">
                            <p class="leading-none font-semibold ">08:00</p>
                            <div class="flex justify-center items-end">
                                <p class="text-[10px] flex">{{ schedule.flight.route.origin_airport.location }}</p>
                            </div>
                            
                        </div>
                        
                        <p class="flex-1 border h-0 mx-10 border-gray-400"></p>
                        <div class="flex flex-col">
                            <p class=" leading-none font-semibold">10:00</p>
                            <div class="flex justify-center items-end">
                                <p class="text-[10px]">{{ schedule.flight.route.destination_airport.location }}</p>
                            </div>
                        </div>
                    
                    </div>  

                    <div class="flex-1 leading-none max-w-[180px] space-y-1 items-center ">
                        <p class="flex justify-between text-[#828282] text-[10px] w-full ">
                            <span class=" flex-1">Duration:</span>
                            <strong class="text-black   flex-1 text-left ">2 hr</strong>
                        </p>
                        <p class="flex justify-between text-[#828282] text-[10px] w-full">
                            <span class=" flex-1">Flight Number:</span>
                            <strong class="text-black  flex-1 text-left">{{ schedule.flight.flight_number }}</strong>
                        </p>
                        <p class="flex justify-between text-[#828282] text-[10px] w-full">
                            <span class=" flex-1">Operated by:</span>
                            <strong class="text-black  flex-1 text-left">{{ schedule.flight.airline.name }}</strong>
                        </p>

                        <button type="button" class="w-full px-10 py-2 text-[10px] mt-1 shadow-md/50 bg-[#F4EB08] hover:bg-[#F4EB08]/80 cursor-pointer rounded-full">
                            Itinerary Details
                        </button>
                    </div>



                    <div class="  flex flex-col  items-center">
                        <p class="text-xs text-[#828282]">All-in Fare</p>
                        <strong>PHP  {{ schedule.price }}</strong>
                    </div>
                    
                    <div class="flex justify-center">
                        {% if schedule.id|stringformat:"s" == request.session.depart_schedule_id|stringformat:"s" %}
                            <!-- ✅ Depart indicator -->
                            <span class="px-6 py-1 bg-green-500 text-white rounded-full text-sm">
                                Depart Selected
                            </span>
                        {% else %}
                            <!-- Select button -->
                            <button value="{{ schedule.id }}" name="schedule" type="submit"
                                class="bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer  px-15 py-1 text-white rounded-full shadow-md/50">
                                Select
                            </button>

                        {% endif %}
                    </div>
                </div>
                
                {% endfor %}
                <div class=" flex justify-center mt-7 ">
                    <button type="button" class="bg-white hover:bg-gray-100  cursor-pointer text-xs py-2 px-10 rounded-full hover:shadow-md/10">Show more</button>
                </div>
                {% endif %}

                {% if return_schedules %}
                    <div id="return-section" class="w-full  rounded-2xl flex-col flex   mt-10">
                        <div class="border border-gray-400 w-full h-0 my-10"> </div>

                        <div>
                            <p class=" text-[#828282] text-sm poppins-regular">Select returning flight</p>
                            <div class="flex  leading-none items-center gap-5 flex-1 ">
                                <div class="  flex  justify-center poppins-regular text-base ">
                                    <p class="text-lg font-semibold ">{{ destination.code }}</p>
                                    <p>-</p>
                                    <p class="text-lg font-semibold">{{ destination.location }}</p>
                                </div>
                                <div class="border-2 h-0 w-10"></div>
                                <div class="  flex  justify-center poppins-regular text-base">
                                    <p class="text-lg font-semibold ">{{ origin.code }}</p>
                                    <p>-</p>
                                    <p class="text-lg font-semibold">{{ origin.location }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between my-5"> 
                        <div class="flex gap-4 text-white items-end ">
                            <p class="text-[#828282] text-xs "> filter: </p>
                            <button class="py-2 px-5 rounded-full text-xs  bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer  shadow-md/40 flex justify-between">Time of Flight
                                <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                                    fill="white" viewBox="0 0 24 24" >
                                    <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                                    <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                                </svg>
                            </button>
                            <button class="py-2 px-5 rounded-full text-xs bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer  shadow-md/40 flex justify-between">Stops
                                <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                                    fill="white" viewBox="0 0 24 24" >
                                    <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                                    <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                                </svg>
                            </button>
                            <button class="py-2 px-5 rounded-full text-xs bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer  shadow-md/40  flex justify-between"> Price
                                <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                                    fill="white" viewBox="0 0 24 24" >
                                    <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                                    <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                                </svg>
                            </button>
                        </div>

                        <div class="flex gap-4 text-white  items-end">
                            <p class="text-[#828282] text-xs">Sort by: </p>
                            <button class="py-2 px-5 rounded-full  bg-[#2975F7] text-xs hover:bg-[#2975F7]/80 cursor-pointer  shadow-md/40 flex justify-between">Lowest Price
                                <svg  xmlns="http://www.w3.org/2000/svg" width="15" height="15"  class="ml-2"
                                    fill="white" viewBox="0 0 24 24" >
                                    <!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
                                    <path d="M17.35 8H6.65c-.64 0-.99.76-.56 1.24l5.35 6.11c.3.34.83.34 1.13 0l5.35-6.11C18.34 8.76 18 8 17.36 8Z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {% for return_schedule in return_schedules %}
                        <div class="w-full h-[100px] border shadow-md/10 rounded-2xl mb-3  px-7 flex justify-between items-center gap-15 text-sm ">
                            <div class="  flex flex-1  justify-between items-center  poppins-regular text-base ">
                                <div class="flex flex-col">
                                    <p class="leading-none font-semibold ">08:00</p>
                                    <div class="flex justify-center items-end">
                                        <p class="text-[10px] flex">{{ return_schedule.flight.route.origin_airport.location }}</p>
                                    </div>
                                </div>
                                
                                <p class="flex-1 border h-0 mx-10 border-gray-400"></p>
                                <div class="flex flex-col">
                                    <p class="leading-none font-semibold ">10:00</p>
                                    <div class="flex justify-center items-end">
                                        <p class="text-[10px]">{{ return_schedule.flight.route.destination_airport.location }}</p>
                                    </div>
                                </div>
                                
                            </div>

                            <div class="flex-1 leading-none max-w-[180px] space-y-1">
                                <p class="flex justify-between text-[#828282] text-[10px] w-full">
                                    <span class="flex-1">Duration:</span>
                                    <strong class="text-black flex-1">2 hr</strong>
                                </p>
                                <p class="flex justify-between text-[#828282] text-[10px] w-full">
                                    <span class="flex-1">Flight Number:</span>
                                    <strong class="text-black flex-1">{{ return_schedule.flight.flight_number }}</strong>
                                </p>
                                <p class="flex justify-between text-[#828282] text-[10px] w-full">
                                    <span class="flex-1">Operated by:</span>
                                    <strong class="text-black flex-1 text-left">{{ return_schedule.flight.airline.name }}</strong>
                                </p>

                                <button type="button" class="w-full px-10 py-2 text-[10px] mt-1 shadow-md/50 bg-[#F4EB08] hover:bg-[#F4EB08]/80 cursor-pointer rounded-full">
                                    Itinerary Details
                                </button>
                            </div>


                            <div class="  flex flex-col  items-center">
                                <p class="text-sm text-[#828282]">All-in Fare</p>
                                <strong>PHP  {{ return_schedule.price }}</strong>
                            </div>

                            <div class="   flex justify-center ">
                                    {% csrf_token %}
                                    <button value="{{ return_schedule.id }}" name="return_schedule" type="submit" class="bg-[#2975F7] hover:bg-[#2975F7]/80 cursor-pointer  px-15 py-1 text-white rounded-full shadow-md/50">select</button>
                               
                            </div>
                        </div>
                        
                    {% endfor %}
                    <div class=" flex justify-center mt-7 ">
                        <button type="button" class="bg-white hover:bg-gray-100  cursor-pointer text-xs py-2 px-10 rounded-full hover:shadow-md/10">Show more</button>
                    </div>
                {% endif %}
                 </form>

                
            </div>
           
            
        </div>

    </main>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        {% if request.session.depart_schedule_id %}
            let returnSection = document.getElementById("return-section");
            if (returnSection) {
                returnSection.scrollIntoView({ behavior: "smooth" });
            }
        {% endif %}
    });
</script>

{% endblock %}