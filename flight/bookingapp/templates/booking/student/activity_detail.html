{% extends 'booking/student/base.html' %}

{% block content %}
<div class="px-30 py-4">
    <button onclick="goBack()" class="inline-flex items-center text-gray-600 hover:text-gray-900">
        <i class="fas fa-arrow-left mr-2"></i>
        Go Back
    </button>
</div>
    
<div class="container mx-auto px-30 py-8">
    <div class="bg-white border border-gray-300 rounded-lg shadow-lg py-10 px-15">
        <!-- Header -->
        <div class="mb-6 flex justify-between">
            <div class="flex flex-col">
                <h1 class="text-2xl font-bold text-gray-800 mb-2 capitalize">{{ activity.title }}</h1>
                <p class="text-gray-600">{{ activity.section.section_code }} - {{ activity.section.section_name }}</p>
                <div class="flex gap-2 mt-2">
                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                        {{ activity.activity_type }}
                    </span>
                    <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Active</span>
                    <span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full">
                        {{ activity.total_points }} points
                    </span>
                </div>
            </div>
           
            <div>
                <span class="text-base flex px-2 py-1 text-gray-700 font-medium rounded-full items-end gap-2">
                    <p class="text-sm text-gray-400">Due:</p> {{ activity.due_date|date:"M j, Y g:i A" }}
                </span>
            </div>
        </div>
        
        <div class="w-full border border-gray-300"></div>

        <!-- Instructions -->
        <div class="my-6">
            <h2 class="text-lg font-semibold mb-2">Instructions</h2>
            <div class="bg-gray-50 px-6 py-4 rounded-lg border border-gray-200">
                <p class="text-black whitespace-pre-line">{{ activity.instructions }}</p>
            </div>
        </div>

        <!-- Requirements Grid -->
        <div class="flex-1 flex flex-col space-y-3 mb-6">
            <div class="flex justify-between">
                <button class="text-xs text-gray-700 bg-[#FFC83D] py-2 px-7 rounded-full">
                    Trip type: <strong class="text-black text-sm">{{ activity.required_trip_type|title }}</strong>
                </button>
                <button class="text-xs text-gray-100 bg-[#093704] py-2 px-7 rounded-full">
                    Class: <strong class="text-white text-sm">{{ activity.required_travel_class|title }}</strong>
                </button>
            </div>

            <div class="w-full h-[150px] border border-gray-400 rounded-lg p-4">
                <div class="flex-1 h-full border border-[#FFC83D] flex rounded-lg px-13">
                    <div class="flex flex-1 my-auto">
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">From:</p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">
                                    {% if activity.required_origin_airport %}
                                        {{ activity.required_origin_airport.code }}
                                    {% else %}
                                        {{ activity.required_origin }}
                                    {% endif %}
                                </h1>
                                <p class="text-sm">
                                    {% if activity.required_origin_airport %}
                                        {{ activity.required_origin_airport.name }}
                                    {% else %}
                                        Origin Airport
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">To:</p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">
                                    {% if activity.required_destination_airport %}
                                        {{ activity.required_destination_airport.code }}
                                    {% else %}
                                        {{ activity.required_destination }}
                                    {% endif %}
                                </h1>
                                <p class="text-sm">
                                    {% if activity.required_destination_airport %}
                                        {{ activity.required_destination_airport.name }}
                                    {% else %}
                                        Destination Airport
                                    {% endif %}
                                </p>
                            </div>
                        </div>    
                    </div>
                    
                    <div class="max-w-1 border my-5 border-gray-300 mx-2"></div>

                    <div class="flex flex-1 my-auto">
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">Depart:</p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">
                                    {% if activity.required_departure_date %}
                                        {{ activity.required_departure_date|date:"D" }}
                                    {% else %}
                                        Any
                                    {% endif %}
                                </h1>
                                <p class="text-sm">
                                    {% if activity.required_departure_date %}
                                        {{ activity.required_departure_date|date:"F j" }}
                                    {% else %}
                                        Flexible Date
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">
                                {% if activity.required_trip_type == 'round_trip' %}
                                    Return:
                                {% else %}
                                    -
                                {% endif %}
                            </p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">
                                    {% if activity.required_return_date %}
                                        {{ activity.required_return_date|date:"D" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </h1>
                                <p class="text-sm">
                                    {% if activity.required_return_date %}
                                        {{ activity.required_return_date|date:"F j" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </p>
                            </div>
                        </div>    
                    </div>

                    <div class="max-w-1 border my-5 border-gray-300 mx-2"></div>

                    <div class="flex flex-1 my-auto">
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">Passenger:</p>
                            <div class="flex flex-1 items-center my-auto justify-around">
                                <div class="flex items-center gap-2">
                                    <p class="text-xs text-gray-700">Adult: </p>
                                    <h1 class="text-xl font-semibold">{{ activity.required_passengers }}</h1>
                                </div>
                                <div class="flex items-center gap-2">
                                    <p class="text-xs text-gray-700">Child/ren: </p>
                                    <h1 class="text-xl font-semibold">{{ activity.required_children }}</h1>
                                </div>
                                <div class="flex items-center gap-2">
                                    <p class="text-xs text-gray-700">Infant: </p>
                                    <h1 class="text-xl font-semibold">{{ activity.required_infants }}</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% if activity.required_max_price %}
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                    <span class="text-sm font-semibold text-blue-800">Maximum Price: ${{ activity.required_max_price }}</span>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="w-full border border-gray-300"></div>

        <!-- Passenger Information with Add-ons Integrated -->
        {% if activity.require_passenger_details and activity.passengers.exists %}
        <div class="space-y-5 mt-6">
            <h1 class="text-2xl font-semibold">Passenger Information</h1>
            <p class="text-sm text-gray-600">Students must provide the following passenger details:</p>
            
            {% for passenger in activity.passengers.all %}
            <div class="flex-1 border px-15 py-5 rounded-lg border-gray-400">
                <div class="my-5 flex flex-col">
                    <div class="flex justify-between items-center">
                        <h1 class="text-xl font-semibold">
                            Passenger {{ forloop.counter }} 
                            {% if passenger.is_primary %}(Primary){% endif %}
                        </h1>
                        <span class="text-xs px-2 py-1 
                            {% if passenger.gender == 'male' %}bg-blue-100 text-blue-800
                            {% elif passenger.gender == 'female' %}bg-pink-100 text-pink-800
                            {% else %}bg-gray-100 text-gray-800{% endif %} 
                            rounded-full">
                            {{ passenger.get_gender_display }}
                        </span>
                    </div>
                    <p class="text-xs text-gray-600">Please make sure that you enter your name exactly as it is shown on your Valid ID</p>
                </div>

                <div class="flex-1">
                    <div class="flex gap-5">
                        <div class="flex flex-col gap-2 w-[70px]">
                            <label class="flex">Gender: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.get_gender_display }}</p>
                        </div>
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">First name: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.first_name }}</p>
                        </div>
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">Last name: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.last_name }}</p>
                        </div>
                        <div class="flex flex-col min-w-15 gap-2">
                            <label class="flex">M.I.</label>
                            <p class="border h-[40px] px-3 flex items-center">
                                {% if passenger.middle_name %}
                                    {{ passenger.middle_name }}
                                {% else %}
                                    -
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <div class="flex flex-col mt-5">
                        <h1 class="font-semibold text-xl">Date of Birth</h1>
                        <div class="flex gap-5">
                            <div class="flex flex-col w-[70px] gap-2">
                                <label class="flex">Day: <p class="text-red-500"> *</p> </label>
                                <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"d" }}</p>
                            </div>
                            <div class="flex flex-col flex-1 gap-2">
                                <label class="flex">Month: <p class="text-red-500"> *</p> </label>
                                <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"F" }}</p>
                            </div>
                            <div class="flex flex-col flex-1 gap-2">
                                <label class="flex">Year: <p class="text-red-500"> *</p> </label>
                                <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"Y" }}</p>
                            </div>
                            <div class="flex flex-col min-w-15 gap-2"></div>
                        </div>
                    </div>

                    <div class="flex gap-5 mt-5">
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">Nationality: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.nationality }}</p>
                        </div>
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">Date of Birth: </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"M d, Y" }}</p>
                        </div>
                        <div class="flex flex-col min-w-15 gap-2"></div>
                    </div>
                </div>

                <!-- Add-ons for this specific passenger -->
                {% with passenger_addons=activity.activity_addons.all %}
                    {% for addon_req in passenger_addons %}
                        {% if addon_req.passenger == passenger %}
                            {% if forloop.first %}
                            <div class="mt-8 border-t border-gray-300 pt-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Required Add-ons for this Passenger</h2>
                                <div class="space-y-3">
                            {% endif %}
                            
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-[#093704] rounded-full flex items-center justify-center">
                                        <span class="text-white text-xs font-semibold">+</span>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold text-gray-800">
                                            {{ addon_req.addon.name }}
                                            {% if addon_req.addon.airline %}
                                            <span class="text-xs text-gray-500">({{ addon_req.addon.airline.code }})</span>
                                            {% endif %}
                                        </h3>
                                        {% if addon_req.addon.type %}
                                        <p class="text-xs text-gray-600">{{ addon_req.addon.type.name }}</p>
                                        {% endif %}
                                        {% if addon_req.addon.description %}
                                        <p class="text-xs text-gray-500 mt-1">{{ addon_req.addon.description }}</p>
                                        {% endif %}
                                        {% if addon_req.notes %}
                                        <p class="text-xs text-blue-600 mt-1"><strong>Notes:</strong> {{ addon_req.notes }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-4">
                                    <div class="text-right">
                                        <span class="text-sm font-semibold text-green-600">₱{{ addon_req.addon.price }}</span>
                                        {% if addon_req.quantity_per_passenger > 1 %}
                                        <p class="text-xs text-gray-500">Qty: {{ addon_req.quantity_per_passenger }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    {% if addon_req.is_required %}
                                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-semibold">
                                        Required
                                    </span>
                                    {% else %}
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-semibold">
                                        Optional
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            {% if forloop.last %}
                                </div>
                            </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endwith %}
            </div>
            {% endfor %}

            <!-- General Add-ons (not assigned to specific passengers) -->
            {% with passenger_addons=activity.activity_addons.all %}
                {% for addon_req in passenger_addons %}
                    {% if not addon_req.passenger %}
                        {% if forloop.first %}
                        <div class="space-y-5">
                            <h1 class="text-2xl font-semibold">General Add-ons</h1>
                            <p class="text-sm text-gray-600">The following add-ons apply to the booking in general:</p>
                            
                            <div class="bg-white border border-gray-200 rounded-lg p-6">
                                <div class="space-y-3">
                        {% endif %}
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-[#093704] rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs font-semibold">+</span>
                                </div>
                                <div>
                                    <h3 class="text-sm font-semibold text-gray-800">
                                        {{ addon_req.addon.name }}
                                        {% if addon_req.addon.airline %}
                                        <span class="text-xs text-gray-500">({{ addon_req.addon.airline.code }})</span>
                                        {% endif %}
                                    </h3>
                                    {% if addon_req.addon.type %}
                                    <p class="text-xs text-gray-600">{{ addon_req.addon.type.name }}</p>
                                    {% endif %}
                                    {% if addon_req.addon.description %}
                                    <p class="text-xs text-gray-500 mt-1">{{ addon_req.addon.description }}</p>
                                    {% endif %}
                                    {% if addon_req.notes %}
                                    <p class="text-xs text-blue-600 mt-1"><strong>Notes:</strong> {{ addon_req.notes }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <div class="text-right">
                                    <span class="text-sm font-semibold text-green-600">₱{{ addon_req.addon.price }}</span>
                                    {% if addon_req.quantity_per_passenger > 1 %}
                                    <p class="text-xs text-gray-500">Qty: {{ addon_req.quantity_per_passenger }}</p>
                                    {% endif %}
                                </div>
                                
                                {% if addon_req.is_required %}
                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-semibold">
                                    Required
                                </span>
                                {% else %}
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-semibold">
                                    Optional
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if forloop.last %}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% endwith %}
        </div>

        {% elif activity.require_passenger_details %}
        <div class="space-y-5 mt-6">
            <h1 class="text-2xl font-semibold">Passenger Information</h1>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    <span class="text-sm font-semibold text-yellow-800">Passenger details are required but no specific passenger information has been provided.</span>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Display add-ons if there are no passenger details required -->
        {% if not activity.require_passenger_details and activity.activity_addons.exists %}
        <div class="space-y-5 mt-6">
            <h1 class="text-2xl font-semibold">Required Add-ons</h1>
            <p class="text-sm text-gray-600">Students must include the following add-ons in their booking:</p>
            
            <div class="space-y-4">
                {% for addon_req in activity.activity_addons.all %}
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-[#093704] rounded-full flex items-center justify-center">
                            <span class="text-white text-xs font-semibold">+</span>
                        </div>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-800">
                                {{ addon_req.addon.name }}
                                {% if addon_req.addon.airline %}
                                <span class="text-xs text-gray-500">({{ addon_req.addon.airline.code }})</span>
                                {% endif %}
                            </h3>
                            {% if addon_req.addon.type %}
                            <p class="text-xs text-gray-600">{{ addon_req.addon.type.name }}</p>
                            {% endif %}
                            {% if addon_req.addon.description %}
                            <p class="text-xs text-gray-500 mt-1">{{ addon_req.addon.description }}</p>
                            {% endif %}
                            {% if addon_req.notes %}
                            <p class="text-xs text-blue-600 mt-1"><strong>Notes:</strong> {{ addon_req.notes }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <span class="text-sm font-semibold text-green-600">₱{{ addon_req.addon.price }}</span>
                            {% if addon_req.quantity_per_passenger > 1 %}
                            <p class="text-xs text-gray-500">Qty: {{ addon_req.quantity_per_passenger }}</p>
                            {% endif %}
                        </div>
                        
                        {% if addon_req.is_required %}
                        <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-semibold">
                            Required
                        </span>
                        {% else %}
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-semibold">
                            Optional
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if activity.time_limit_minutes %}
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mt-6">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="text-sm font-semibold text-orange-800">Time Limit: {{ activity.time_limit_minutes }} minutes</span>
            </div>
        </div>
        {% endif %}

        <!-- Submission Status -->
        {% if existing_submission %}
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mt-6">
            <p class="font-semibold">✅ Activity Submitted</p>
            <p class="mt-1">You have already submitted this activity.</p>
            {% if existing_submission.score %}
            <div class="flex gap-3 flex-col">
                <p class="mt-1"><strong>Score:</strong> {{ existing_submission.score }}/{{ activity.total_points }}</p>
                <a href="{% url 'bookingapp:student_work_detail' existing_submission.id %}" 
                    class="bg-[#FFC83D] hover:bg-[#FFC83D]/80 cursor-pointer text-center text-gray-700 font-medium px-4 py-2 rounded text-sm">
                    View Work Details
                </a> 
            </div>
            {% endif %}
        </div>
        {% else %}
            {% if activity.is_code_active and not code_expired %}
            <div class="text-center mt-6">
                <p class="text-gray-600 mb-4">Click the button below to start your activity booking:</p>
                <button onclick="openActivityModal()" 
                    class="inline-block bg-[#093704] hover:bg-[#093704]/80 cursor-pointer text-white font-bold py-3 px-6 rounded-md transition duration-200">
                    Start Activity Booking
                </button>
                <p class="text-sm text-gray-500 mt-2">You'll need to enter the activity code provided by your instructor.</p>
                <p class="text-xs text-green-600 mt-1">✓ Activity code is active</p>
                <!-- SIMPLIFIED: Only show due date, no separate code expiration -->
                <p class="text-xs text-orange-600">Due: {{ activity.due_date|date:"M j, Y g:i A" }}</p>
            </div>
            {% else %}
            <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mt-6">
                <p class="font-semibold">⏳ Activity Not Available</p>
                <p class="mt-1">
                    {% if code_expired %}
                    This activity has expired. The due date has passed.
                    {% else %}
                    This activity cannot be started yet. The instructor needs to activate the activity code.
                    {% endif %}
                </p>
            </div>
            {% endif %}
        {% endif %}
    </div>
</div>

<!-- Activity Code Modal -->
<div id="activityModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
        <div class="p-6 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-800">Enter Activity Code</h3>
        </div>
        
        <form method="GET" action="{% url 'bookingapp:main' %}">
            <div class="p-6">
                <div class="mb-4">
                    <label for="activity_code" class="block text-sm font-medium text-gray-700 mb-2">
                        Activity Code for "{{ activity.title }}"
                    </label>
                    <input 
                        type="text" 
                        id="activity_code" 
                        name="activity_code" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-sm focus:outline-none focus:ring-2 focus:ring-[#093704] focus:border-transparent"
                        placeholder="Enter the code provided by your instructor" 
                        required
                        autocomplete="off"
                    >
                    <p class="mt-1 text-xs text-gray-500">
                        This code ensures your booking is linked to this activity.
                    </p>
                    <!-- SIMPLIFIED: Show due date information -->
                    <p class="mt-1 text-xs text-orange-600">
                        <strong>Due:</strong> {{ activity.due_date|date:"M j, Y g:i A" }}
                    </p>
                </div>
                
                <!-- Hidden field to pass activity ID -->
                <input type="hidden" name="activity_id" value="{{ activity.id }}">
            </div>
            
            <div class="p-6 border-t border-gray-200 flex justify-end gap-3">
                <button 
                    type="button" 
                    onclick="closeActivityModal()" 
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-sm cursor-pointer transition-colors"
                >
                    Cancel
                </button>
                <button 
                    type="submit" 
                    class="px-4 py-2 text-sm font-medium text-white bg-[#093704] hover:bg-[#093704]/80 rounded-sm cursor-pointer transition-colors"
                >
                    Start Flight Booking
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function openActivityModal() {
    document.getElementById('activityModal').classList.remove('hidden');
    document.getElementById('activity_code').focus();
}

function closeActivityModal() {
    document.getElementById('activityModal').classList.add('hidden');
}

// Close modal when clicking outside
document.getElementById('activityModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeActivityModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeActivityModal();
    }
});

// Prevent form submission if code is empty
document.querySelector('form').addEventListener('submit', function(e) {
    const codeInput = document.getElementById('activity_code');
    if (!codeInput.value.trim()) {
        e.preventDefault();
        alert('Please enter the activity code.');
        codeInput.focus();
    }
});

function goBack() {
    window.history.back();
}
</script>

<style>
/* Smooth transitions for the modal */
#activityModal {
    transition: opacity 0.3s ease;
}
</style>
{% endblock %}