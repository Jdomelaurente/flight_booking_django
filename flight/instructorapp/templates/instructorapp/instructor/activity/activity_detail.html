{% extends 'instructorapp/base.html' %}
{% block title %}{{ activity.title }}{% endblock %}

{% block content %}
<div class="flex flex-1 flex-col">
    <div class="flex mb-2">
        <a href="{% url 'section_detail' activity.section.id %}" class="ml-5 flex text-xl items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="#045946" viewBox="0 0 24 24">
                <path d="M14.29 6.29 8.59 12l5.7 5.71 1.42-1.42-4.3-4.29 4.3-4.29z"></path>
            </svg> 
            Back to Section
        </a>
    </div>
    <div class="w-full border border-b border-gray-300"></div>

    <div class="flex flex-col mt-10 px-30 space-y-10">
        <div class="flex gap-10 text-xs font-medium">
            <a href="#" class="text-[#045946] border-b-2 border-[#045946] pb-1">Instruction/s</a>
            <a href="#" class="text-gray-600 hover:text-[#045946]">Student work</a>
        </div>

        <div class="flex justify-between items-center">
            <div class="flex gap-6 items-center">
                <div class="w-10 h-10 rounded-full bg-[#045946] flex items-center justify-center">
                    <span class="text-white text-xs font-semibold">
                        {{ activity.activity_type|slice:":1"|upper }}
                    </span>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-xl font-semibold">{{ activity.title }}</h1>
                    <p class="text-xs text-gray-400 leading-none">{{ activity.section.section_code }} - {{ activity.section.section_name }}</p>
                    <p class="text-xs text-gray-400">Due: {{ activity.due_date|date:"M j, Y" }}</p>
                </div>
            </div>

            <div class="flex flex-col gap-1">
                {% if activity.is_code_active %}
                <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold">
                    Active Code: {{ activity.activity_code }}
                </div>
                {% else %}
                <div class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold">
                    Draft
                </div>
                {% endif %}
            </div>
        </div>

        <div class="w-full border border-gray-400"></div>

        <div class="flex-1">
            <p class="text-sm text-justify">{{ activity.instructions }}</p>
        </div>

        <div class="flex-1 flex flex-col space-y-3">
            <div class="flex justify-between">
                <button class="text-xs text-gray-700 bg-[#FFC83D] py-2 px-7 rounded-full">
                    Trip type: <strong class="text-black text-sm">{{ activity.required_trip_type|title }}</strong>
                </button>
                <button class="text-xs text-gray-100 bg-[#045946] py-2 px-7 rounded-full">
                    Class: <strong class="text-white text-sm">{{ activity.required_travel_class|title }}</strong>
                </button>
            </div>

            <div class="w-full h-[150px] border border-gray-400 rounded-lg p-4">
                <div class="flex-1 h-full border border-[#FFC83D] flex rounded-lg px-13">

                    <div class="flex flex-1 my-auto">
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">From:</p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">{{ activity.required_origin }}</h1>
                                <p class="text-sm">Origin Airport</p>
                            </div>
                        </div>
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">To:</p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">{{ activity.required_destination }}</h1>
                                <p class="text-sm">Destination Airport</p>
                            </div>
                        </div>    
                    </div>
                    
                    <div class="max-w-1 border my-5 border-gray-300 mx-2"></div>

                    <div class="flex flex-1 my-auto">
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">Depart:</p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">
                                    {% if activity.required_departure_date %}
                                        {{ activity.required_departure_date|date:"D" }}
                                    {% else %}
                                        Any
                                    {% endif %}
                                </h1>
                                <p class="text-sm">
                                    {% if activity.required_departure_date %}
                                        {{ activity.required_departure_date|date:"F j" }}
                                    {% else %}
                                        Flexible Date
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">
                                {% if activity.required_trip_type == 'round_trip' %}
                                    Return:
                                {% else %}
                                    -
                                {% endif %}
                            </p>
                            <div class="flex flex-col mx-auto justify-center my-auto">
                                <h1 class="text-base font-semibold leading-none">
                                    {% if activity.required_return_date %}
                                        {{ activity.required_return_date|date:"D" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </h1>
                                <p class="text-sm">
                                    {% if activity.required_return_date %}
                                        {{ activity.required_return_date|date:"F j" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </p>
                            </div>
                        </div>    
                    </div>

                    <div class="max-w-1 border my-5 border-gray-300 mx-2"></div>

                    <div class="flex flex-1 my-auto">
                        <div class="flex-1 flex flex-col my-3 space-y-2">
                            <p class="text-xs">Passenger:</p>
                            <div class="flex flex-1 items-center my-auto justify-around">
                                <div class="flex items-center gap-2">
                                    <p class="text-xs text-gray-700">Adult: </p>
                                    <h1 class="text-xl font-semibold">{{ activity.required_passengers }}</h1>
                                </div>
                                <div class="flex items-center gap-2">
                                    <p class="text-xs text-gray-700">Child/ren: </p>
                                    <h1 class="text-xl font-semibold">{{ activity.required_children }}</h1>
                                </div>
                                <div class="flex items-center gap-2">
                                    <p class="text-xs text-gray-700">Infant: </p>
                                    <h1 class="text-xl font-semibold">{{ activity.required_infants }}</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% if activity.required_max_price %}
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>
                    <span class="text-sm font-semibold text-blue-800">Maximum Price: ${{ activity.required_max_price }}</span>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="w-full border border-gray-300"></div>

        {% if activity.require_passenger_details and activity.passengers.exists %}
        <div class="space-y-5">
            <h1 class="text-2xl font-semibold">Passenger Information</h1>
            <p class="text-sm text-gray-600">Students must provide the following passenger details:</p>
            
            {% for passenger in activity.passengers.all %}
            <div class="flex-1 border px-15 py-5 rounded-lg border-gray-400">
                <div class="my-5 flex flex-col">
                    <div class="flex justify-between items-center">
                        <h1 class="text-xl font-semibold">
                            Passenger {{ forloop.counter }} 
                            {% if passenger.is_primary %}(Primary){% endif %}
                        </h1>
                        <span class="text-xs px-2 py-1 
                            {% if passenger.gender == 'male' %}bg-blue-100 text-blue-800
                            {% elif passenger.gender == 'female' %}bg-pink-100 text-pink-800
                            {% else %}bg-gray-100 text-gray-800{% endif %} 
                            rounded-full">
                            {{ passenger.get_gender_display }}
                        </span>
                    </div>
                    <p class="text-xs text-gray-600">Please make sure that you enter your name exactly as it is shown on your Valid ID</p>
                </div>

                <div class="flex-1">
                    <div class="flex gap-5">
                        <div class="flex flex-col gap-2 w-[70px]">
                            <label class="flex">Gender: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.get_gender_display }}</p>
                        </div>
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">First name: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.first_name }}</p>
                        </div>
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">Last name: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.last_name }}</p>
                        </div>
                        <div class="flex flex-col min-w-15 gap-2">
                            <label class="flex">M.I.</label>
                            <p class="border h-[40px] px-3 flex items-center">
                                {% if passenger.middle_name %}
                                    {{ passenger.middle_name }}
                                {% else %}
                                    -
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <div class="flex flex-col mt-5">
                        <h1 class="font-semibold text-xl">Date of Birth</h1>
                        <div class="flex gap-5">
                            <div class="flex flex-col w-[70px] gap-2">
                                <label class="flex">Day: <p class="text-red-500"> *</p> </label>
                                <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"d" }}</p>
                            </div>
                            <div class="flex flex-col flex-1 gap-2">
                                <label class="flex">Month: <p class="text-red-500"> *</p> </label>
                                <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"F" }}</p>
                            </div>
                            <div class="flex flex-col flex-1 gap-2">
                                <label class="flex">Year: <p class="text-red-500"> *</p> </label>
                                <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"Y" }}</p>
                            </div>
                            <div class="flex flex-col min-w-15 gap-2"></div>
                        </div>
                    </div>

                    <div class="flex gap-5 mt-5">
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">Nationality: <p class="text-red-500"> *</p> </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.nationality }}</p>
                        </div>
                        <div class="flex flex-col flex-1 gap-2">
                            <label class="flex">Date of Birth: </label>
                            <p class="border h-[40px] px-3 flex items-center">{{ passenger.date_of_birth|date:"M d, Y" }}</p>
                        </div>
                        <div class="flex flex-col min-w-15 gap-2"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% elif activity.require_passenger_details %}
        <div class="space-y-5">
            <h1 class="text-2xl font-semibold">Passenger Information</h1>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    <span class="text-sm font-semibold text-yellow-800">Passenger details are required but no specific passenger information has been provided.</span>
                </div>
            </div>
        </div>
        {% endif %}

        {% if activity.time_limit_minutes %}
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="text-sm font-semibold text-orange-800">Time Limit: {{ activity.time_limit_minutes }} minutes</span>
            </div>
        </div>
        {% endif %}

        <div class="w-full flex justify-center mt-5">
            {% if activity.is_code_active %}
            <div class="text-center space-y-3">
                <div class="bg-green-100 border border-green-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-green-800">Activity Code: {{ activity.activity_code }}</h3>
                    <p class="text-sm text-green-600">Share this code with students to allow submissions</p>
                    <p class="text-xs text-green-500">Expires: {{ activity.code_expires_at|date:"M j, Y g:i A" }}</p>
                </div>
                <button class="bg-[#045946] hover:bg-[#045946]/80 cursor-pointer py-3 w-[434px] text-lg text-white mx-auto">
                    View Submissions
                </button>
            </div>
            {% else %}
            <form method="POST" action="{% url 'activate_activity' activity.id %}" class="text-center">
                {% csrf_token %}
                <button type="submit" class="bg-[#045946] hover:bg-[#045946]/80 cursor-pointer py-3 w-[434px] text-lg text-white mx-auto">
                    Activate Activity Code
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}